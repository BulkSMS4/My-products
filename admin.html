<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin — ZeroPay Store</title>
<style>
  :root{--wa-green:#128C7E;--wa-dark:#075E54;--bg:#e5ddd5}
  body, html{margin:0;padding:0;font-family:Arial,sans-serif;height:100%;background:var(--bg);color:#222}
  body{display:flex;flex-direction:column;}

  /* Login modal */
  #loginModal {
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:9999;
  }
  #loginModal div {
    background:#fff;padding:30px;border-radius:12px;width:340px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,0.3);
  }
  #loginModal input {width:100%;padding:10px;margin:12px 0;border-radius:6px;border:1px solid #ccc;font-size:16px;}
  #loginModal button {padding:10px 16px;border:none;border-radius:6px;background:var(--wa-green);color:#fff;font-weight:bold;font-size:16px;cursor:pointer;}
  #loginModal button:hover{opacity:.95;}
  #loginModal p{margin-top:6px;font-size:13px;color:#555;}

  /* App layout */
  #appWrap{display:flex;flex:1;height:100vh;overflow:hidden}
  /* Drawer */
  .drawer-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.18); display:none; z-index:9995; }
  .drawer { position:fixed; left:0; top:0; height:100vh; width:300px; max-width:82%; transform:translateX(-105%); background:var(--wa-dark); color:#fff; padding:18px 12px; box-shadow:4px 0 20px rgba(0,0,0,0.2); z-index:10000; transition:transform .28s cubic-bezier(.2,.9,.3,1); display:flex; flex-direction:column; }
  .drawer.open { transform:translateX(0); }
  .drawer h2{ margin:6px 0 14px; font-size:20px; color:#fff; text-align:left; padding-left:6px }
  .drawer .menu-item{ background:transparent; border:0; color:#fff; padding:10px 12px; text-align:left; width:100%; display:block; font-size:15px; border-radius:8px; cursor:pointer; margin-bottom:6px; }
  .drawer .menu-item:hover{ background:rgba(255,255,255,0.06); }
  .drawer .menu-item.logout{ margin-top:auto; background:#c0392b; }
  .drawer .menu-item.logout:hover{ background:#e74c3c; }

  /* Topbar */
  #topbar{height:64px;display:flex;align-items:center;padding:8px 12px;background:transparent;gap:10px}
  #hamburger{width:46px;height:46px;border-radius:8px;border:0;background:var(--wa-dark);color:#fff;font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.12)}
  #title { font-weight:700;color:var(--wa-dark);font-size:18px }

  /* main */
  #main { flex:1; padding:18px; overflow:auto; width:100%; height:calc(100vh - 64px); box-sizing:border-box; }
  #mainInner { max-width:1100px; margin:6px auto; }

  /* Products */
  .product-item{padding:12px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;background:#fff;border-radius:8px;margin-bottom:10px;box-shadow:0 2px 5px rgba(0,0,0,0.03);}
  .small{font-size:13px;color:#555;}
  button.inline{padding:6px 10px;border:none;border-radius:6px;background:var(--wa-green);color:#fff;font-weight:bold;cursor:pointer;margin:2px;transition:0.2s;}
  button.inline:hover{opacity:.9;}

  .admin-carousel img { width:90px; height:70px; object-fit:cover; border-radius:6px; border:1px solid #ccc; }
  .image-preview img { max-width:100px; margin-right:5px; margin-top:5px; border-radius:6px; border:1px solid #ccc; }

  input,textarea,select{padding:8px;border-radius:6px;border:1px solid #ccc;margin-bottom:8px;width:100%;font-size:14px;}
  textarea{resize:vertical; min-height:80px;}
  h3{margin-top:10px;color:var(--wa-dark);}

  /* Popup composer */
  #popupPreview { background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.06); }

  /* Ads preview area (top and bottom) */
  .ads-preview-container{margin:12px 0;display:flex;flex-direction:column;gap:12px}
  .ad-card{background:#fff;padding:10px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.05);display:flex;gap:12px;align-items:flex-start}
  .ad-media img, .ad-media video{max-width:160px;border-radius:8px}
  .ad-body{flex:1}
  .ad-actions{display:flex;gap:8px;align-items:center;margin-top:8px}
  .color-box{display:inline-block;width:18px;height:18px;border-radius:4px;border:1px solid #ccc;vertical-align:middle;margin-left:8px}

  /* Ads settings */
  .ads-section{background:#fff;padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.04);margin-bottom:12px}
  .ads-rows{display:flex;gap:8px;align-items:center;margin-bottom:8px}
  .ads-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}

  @media(max-width:640px){
    .drawer{ width:82%; }
    #hamburger{width:44px;height:44px}
    #mainInner{ margin:6px 12px }
  }
</style>
</head>
<body>

<!-- Login Modal -->
<div id="loginModal" aria-hidden="false">
  <div>
    <h2>Admin Login</h2>
    <input type="password" id="adminPassword" placeholder="Enter Password" />
    <button id="loginBtn">Login</button>
    <p style="font-size:12px;color:#555;">Password is hidden for security.</p>
    <p id="loginError" style="color:red;font-size:13px;display:none;">Wrong password!</p>
  </div>
</div>

<!-- Drawer backdrop -->
<div id="drawerBackdrop" class="drawer-backdrop" style="display:none"></div>

<!-- Drawer (slide-out menu) -->
<div id="drawer" class="drawer" role="navigation" aria-label="Admin menu">
  <h2>ZeroPay Admin</h2>
  <button class="menu-item" data-action="home">Home</button>
  <button class="menu-item" data-action="products">Products</button>
  <button class="menu-item" data-action="add-product">Add Product</button>
  <button class="menu-item" data-action="popups">Pop-Ups</button>
  <button class="menu-item" data-action="ads">Ads Settings</button>
  <button class="menu-item" data-action="export">Export JSON</button>
  <button class="menu-item" data-action="reset">Reset Store</button>
  <button class="menu-item logout" data-action="logout">Logout</button>
  <div style="margin-top:12px;color:#dcefe9;font-size:12px;padding-left:6px">Tip: Export popup.json / ads.json and upload to your site root to publish to visitors.</div>
</div>

<!-- App wrapper -->
<div id="appWrap">

  <div style="flex:1;display:flex;flex-direction:column;">
    <div id="topbar">
      <button id="hamburger" title="Open menu">☰</button>
      <div id="title">ZeroPay Store — Admin</div>
    </div>

    <main id="main" role="main" tabindex="-1">
      <div id="mainInner">
        <!-- Views will be dynamically rendered here (home, products, add product, popups, ads) -->
      </div>
    </main>
  </div>
</div>

<script>
/* ==================== Full Admin JS (Products, Popups, Ads, Drawer, Auth) ==================== */

/* Password */
const LOGIN_PASSWORD = 'forgetme';

/* Login elements */
const loginModal = document.getElementById('loginModal');
const loginBtn = document.getElementById('loginBtn');
const loginError = document.getElementById('loginError');

/* Drawer elements */
const drawer = document.getElementById('drawer');
const drawerBackdrop = document.getElementById('drawerBackdrop');
const hamburger = document.getElementById('hamburger');
const mainEl = document.getElementById('main');

/* On load: check auth */
if(localStorage.getItem('zp_admin_auth') === '1'){
  loginModal.style.display = 'none';
  initDashboard();
} else loginModal.style.display = 'flex';

/* Login logic */
loginBtn.onclick = ()=>{
  const pass = document.getElementById('adminPassword').value;
  if(pass === LOGIN_PASSWORD){
    localStorage.setItem('zp_admin_auth','1');
    loginModal.style.display='none';
    initDashboard();
  } else loginError.style.display='block';
};

/* Drawer toggle */
function openDrawer(){ drawer.classList.add('open'); drawerBackdrop.style.display='block'; localStorage.setItem('zp_drawer_open','1'); }
function closeDrawer(){ drawer.classList.remove('open'); drawerBackdrop.style.display='none'; localStorage.setItem('zp_drawer_open','0'); }
hamburger.addEventListener('click',(e)=>{ e.stopPropagation(); drawer.classList.contains('open')?closeDrawer():openDrawer(); });
drawerBackdrop.addEventListener('click', closeDrawer);
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeDrawer(); });
mainEl.addEventListener('click', ()=>{ if(drawer.classList.contains('open')) closeDrawer(); });
drawer.addEventListener('click', e=>e.stopPropagation());

/* Menu click */
document.querySelectorAll('.drawer .menu-item').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const action = btn.dataset.action;
    localStorage.setItem('zp_admin_view',action);
    handleMenuAction(action);
    closeDrawer();
  });
});

/* ---------------- Utils ---------------- */
function hideAllViews(){
  const ids=['homeView','productList','addProductForm','popupSection','adsSection'];
  ids.forEach(id=>{
    let el=document.getElementById(id); if(el) el.style.display='none';
  });
}
function showView(name){ hideAllViews(); 
  const idMap = { home:'homeView', products:'productList', 'add-product':'addProductForm', popups:'popupSection', ads:'adsSection' };
  const el = document.getElementById(idMap[name]);
  if(el) el.style.display='block';
  localStorage.setItem('zp_admin_view',name);
}

/* Menu actions */
function handleMenuAction(action){
  if(action==='home') showView('home');
  else if(action==='products') showView('products');
  else if(action==='add-product') showView('add-product');
  else if(action==='popups') showView('popups');
  else if(action==='ads') showView('ads');
  else if(action==='export') exportJson();
  else if(action==='reset') resetStore();
  else if(action==='logout') doLogout();
  else showView('home');
}

/* ---------------- Initial Drawer State ---------------- */
(function(){ const open = localStorage.getItem('zp_drawer_open'); if(open==='1') openDrawer(); else closeDrawer(); })();

/* ---------------- Helper: escape ---------------- */
function escapeHtml(str){ return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }

/* ---------------- Admin Init ---------------- */
function initDashboard(){
  renderHome();
  const last = localStorage.getItem('zp_admin_view')||'home';
  showView(last);
}

/* ---------------- Logout ---------------- */
function doLogout(){ localStorage.removeItem('zp_admin_auth'); location.reload(); }

/* ---------------- Export JSON ---------------- */
function exportJson(){
  const data = JSON.stringify(window.products||[],null,2);
  const blob = new Blob([data],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='products.json'; a.click();
  alert('products.json downloaded');
}

/* ---------------- Reset Store ---------------- */
async function resetStore(){
  if(!confirm("Reset store to default products.json?")) return;
  try{
    const r = await fetch('products.json'); if(!r.ok) throw new Error('no file');
    window.products = await r.json();
    localStorage.setItem('zp_products',JSON.stringify(window.products));
    alert('Store reset to products.json'); renderHome();
  }catch(e){ alert('Cannot reset: products.json missing'); }
}

/* ---------------- Home & Products Placeholder ---------------- */
window.products = JSON.parse(localStorage.getItem('zp_products')||'[]');
function renderHome(){ console.log('Render home with products/ads'); }

/* ---------------- Popups Placeholder ---------------- */
window.popups = JSON.parse(localStorage.getItem('zp_popups')||'[]');
function renderExistingPopups(){ console.log('Render popups'); }

</script>

</body>
</html>
<HTML>
