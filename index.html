<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Store</title>
<style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
    header { background:#075E54; color:white; padding:15px; text-align:center; font-size:22px; }

    /* PRODUCT GRID */
    .products { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:15px; padding:20px; }
    .item { background:white; border-radius:8px; padding:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .item img { width:100%; height:150px; object-fit:cover; border-radius:5px; }
    .item h3 { font-size:16px; margin:5px 0; }
    .item p { margin:3px 0; font-size:14px; }
    .buy-btn { background:#128C7E; color:white; padding:8px; border:none; width:100%; border-radius:5px; cursor:pointer; }

    /* CHAT BUTTON */
    #chatBtn {
        position:fixed; bottom:20px; right:20px;
        background:#25D366; color:white;
        border-radius:50%; width:60px; height:60px;
        display:flex; justify-content:center; align-items:center;
        font-size:28px; cursor:pointer; box-shadow:0 3px 8px rgba(0,0,0,0.3);
    }

    /* CHAT BOX */
    #chatBox {
        position:fixed; bottom:90px; right:20px;
        width:320px; background:white; border-radius:10px;
        box-shadow:0 0 10px rgba(0,0,0,0.3);
        display:none; flex-direction:column;
    }
    #chatHeader {
        background:#075E54; color:white; padding:10px;
        border-radius:10px 10px 0 0; text-align:center;
    }
    #chatMessages {
        height:260px; overflow-y:auto; padding:10px;
    }
    .msg { margin:5px 0; padding:8px; border-radius:6px; max-width:80%; }
    .bot { background:#e2ffc7; align-self:flex-start; }
    .user { background:#dcf8c6; align-self:flex-end; }

    #chatInput { display:flex; padding:10px; border-top:1px solid #ccc; }
    #chatInput input { flex:1; padding:8px; border:1px solid #ccc; border-radius:5px; }
    #chatInput button { margin-left:5px; padding:8px; background:#128C7E; color:white; border:none; border-radius:5px; }

    /* REGISTRATION */
    #regForm {
        padding:10px;
        display:flex; flex-direction:column;
    }
    #regForm input {
        margin:5px 0; padding:8px;
        border:1px solid #ccc; border-radius:5px;
    }
    #regForm button {
        background:#25D366; color:white;
        border:none; padding:10px; margin-top:10px;
        border-radius:5px; cursor:pointer;
    }
</style>
</head>
<body>

<header>WhatsApp Store</header>

<div class="products" id="productList">Loading products...</div>

<!-- CHAT BUTTON -->
<div id="chatBtn">ðŸ’¬</div>

<!-- CHAT BOX -->
<div id="chatBox">
    <div id="chatHeader">Customer Care</div>
    <div id="chatMessages"></div>

    <div id="regForm">
        <input id="rName" type="text" placeholder="Full Name" required>
        <input id="rEmail" type="email" placeholder="Email Address" required>
        <input id="rPhone" type="text" placeholder="Phone Number" required>
        <input id="rCountry" type="text" placeholder="Country" required>
        <button onclick="submitRegistration()">Start Chat</button>
    </div>

    <div id="chatInput" style="display:none;">
        <input id="chatText" type="text" placeholder="Type here...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
const BOT_TOKEN = "8003409315:AAEVIPsOYnF8mBaT8l-kmzWucHUTu9Yo8AY";
const CHAT_ID = "8085649636";

/* LOAD PRODUCTS */
fetch("products.json")
.then(res => res.json())
.then(data => {
    const box = document.getElementById("productList");
    box.innerHTML = "";
    data.forEach(p => {
        box.innerHTML += `
        <div class="item">
            <img src="${p.image}">
            <h3>${p.name}</h3>
            <p>${p.price}</p>
            <button class="buy-btn" onclick='buyProduct("${p.name}", "${p.price}")'>Buy</button>
        </div>`;
    });
})
.catch(() => {
    document.getElementById("productList").innerHTML = "Failed to load products.";
});

/* BUY PRODUCT */
function buyProduct(name, price) {
    let msg = `ðŸ›’ *NEW ORDER*\nProduct: ${name}\nPrice: ${price}\n\nUser will provide address on WhatsApp.`;
    
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ chat_id: CHAT_ID, text: msg, parse_mode:"Markdown" })
    });
    
    alert("We received your order. We will contact you shortly.");
}

/* CHAT SYSTEM */
document.getElementById("chatBtn").onclick = () => {
    document.getElementById("chatBox").style.display = "flex";
};

function submitRegistration() {
    let name = rName.value;
    let email = rEmail.value;
    let phone = rPhone.value;
    let country = rCountry.value;

    let text = `ðŸ‘¤ *NEW CUSTOMER REGISTERED*\nName: ${name}\nEmail: ${email}\nPhone: ${phone}\nCountry: ${country}`;

    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ chat_id: CHAT_ID, text:text, parse_mode:"Markdown" })
    });

    localStorage.setItem("chatUser", name);

    document.getElementById("regForm").style.display = "none";
    document.getElementById("chatInput").style.display = "flex";

    botReply("Welcome " + name + "! How can I help you today?");
}

function sendMessage() {
    let text = chatText.value.trim();
    if (!text) return;

    addMsg(text,"user");
    chatText.value = "";

    setTimeout(()=> botReply("I understand. Let me help you with that."),900);
}

function addMsg(msg,type) {
    let box = document.getElementById("chatMessages");
    let div = document.createElement("div");
    div.className = "msg " + type;
    div.innerText = msg;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}

function botReply(txt) {
    addMsg(txt,"bot");
}
</script>

</body>
</html>
